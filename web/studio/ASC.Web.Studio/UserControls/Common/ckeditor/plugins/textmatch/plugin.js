/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
(function(){function n(n,t){for(var r,f=n.length,i=0,u=0;u<f;u+=1){if(r=n[u],t>=i&&i+r.getText().length>=t)return{element:r,offset:t-i};i+=r.getText().length}return null}function t(n,t){for(var i=0;i<n.length;i++)if(t(n[i]))return i;return-1}CKEDITOR.plugins.add("textmatch",{});CKEDITOR.plugins.textMatch={};CKEDITOR.plugins.textMatch.match=function(n,t){var i=CKEDITOR.plugins.textMatch.getTextAndOffset(n),u=CKEDITOR.dom.selection.FILLING_CHAR_SEQUENCE,f=0,r;if(i)return(i.text.indexOf(u)==0&&(f=u.length,i.text=i.text.replace(u,""),i.offset-=f),r=t(i.text,i.offset),!r)?null:{range:CKEDITOR.plugins.textMatch.getRangeInText(n,r.start,r.end+f),text:i.text.slice(r.start,r.end)}};CKEDITOR.plugins.textMatch.getTextAndOffset=function(n){var e,i,o;if(!n.collapsed)return null;var h="",u=0,r=CKEDITOR.plugins.textMatch.getAdjacentTextNodes(n),s=!1,f,c=n.startContainer.type!=CKEDITOR.NODE_ELEMENT;for(f=c?t(r,function(t){return n.startContainer.equals(t)}):n.startOffset-(r[0]?r[0].getIndex():0),e=r.length,i=0;i<e;i+=1)o=r[i],h+=o.getText(),s||(c?i==f?(s=!0,u+=n.startOffset):u+=o.getText().length:(i==f&&(s=!0),i>0&&(u+=r[i-1].getText().length),e==f&&i+1==e&&(u+=o.getText().length)));return{text:h,offset:u}};CKEDITOR.plugins.textMatch.getRangeInText=function(t,i,r){var u=new CKEDITOR.dom.range(t.root),f=CKEDITOR.plugins.textMatch.getAdjacentTextNodes(t),e=n(f,i),o=n(f,r);return u.setStart(e.element,e.offset),u.setEnd(o.element,o.offset),u};CKEDITOR.plugins.textMatch.getAdjacentTextNodes=function(n){if(!n.collapsed)throw new Error("Range must be collapsed.");var f=[],i,r,t,u;for(n.startContainer.type!=CKEDITOR.NODE_ELEMENT?(i=n.startContainer.getParent().getChildren(),r=n.startContainer.getIndex()):(i=n.startContainer.getChildren(),r=n.startOffset),u=r;t=i.getItem(--u);)if(t.type==CKEDITOR.NODE_TEXT)f.unshift(t);else break;for(u=r;t=i.getItem(u++);)if(t.type==CKEDITOR.NODE_TEXT)f.push(t);else break;return f}})()